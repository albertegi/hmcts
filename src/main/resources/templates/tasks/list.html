<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title} ?: 'All Tasks'">All Tasks</title>
    <th:block th:replace="~{layout :: head}"></th:block>
</head>
<body>
<th:block th:replace="~{layout :: navbar}"></th:block>

<main class="container mt-4">
    <th:block th:replace="~{layout :: flash-messages}"></th:block>

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="h2">
                <i class="bi bi-clipboard-check me-2"></i>
                <span th:text="${title} ?: 'All Tasks'">All Tasks</span>
            </h1>
            <p class="text-muted" th:if="${tasks.empty}">No tasks found.</p>
            <p class="text-muted" th:unless="${tasks.empty}">
                <span th:text="${#lists.size(tasks)}">0</span> task(s) found
            </p>
        </div>
        <div class="col-auto">
            <a href="/tasks/new" class="btn btn-primary">
                <i class="bi bi-plus-circle me-1"></i>New Task
            </a>
        </div>
    </div>

    <!-- Filter Buttons -->
    <div class="row mb-3" th:unless="${tasks.empty}">
        <div class="col">
            <div class="btn-group" role="group">
                <a href="/tasks" class="btn btn-outline-secondary">All</a>
                <a href="/tasks/status/PENDING" class="btn btn-outline-warning">Pending</a>
                <a href="/tasks/status/IN_PROGRESS" class="btn btn-outline-info">In Progress</a>
                <a href="/tasks/status/COMPLETED" class="btn btn-outline-success">Completed</a>
                <a href="/tasks/status/CANCELLED" class="btn btn-outline-danger">Cancelled</a>
            </div>
        </div>
    </div>

    <!-- Tasks Grid -->
    <div class="row" th:if="${!tasks.empty}">
        <div class="col-12" th:each="task : ${tasks}">
            <div class="card task-card mb-3"
                 th:classappend="${task.status.name() == 'COMPLETED' ? 'completed' : ''}">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h5 class="card-title mb-2">
                                <span th:text="${task.title}">Task Title</span>
                                <span class="badge status-badge ms-2"
                                      th:class="'bg-' + ${task.status.name() == 'PENDING'} ? 'warning' :
                                                   (${task.status.name() == 'IN_PROGRESS'} ? 'info' :
                                                   (${task.status.name() == 'COMPLETED'} ? 'success' : 'danger'))"
                                      th:text="${task.status.displayName}">Status</span>
                            </h5>
                            <p class="card-text text-muted" th:if="${task.description}">
                                <span th:text="${task.description}">Task description</span>
                            </p>
                            <div class="text-muted small">
                                <i class="bi bi-calendar-event me-1"></i>
                                Due: <span th:text="${#temporals.format(task.dueDate, 'dd/MM/yyyy HH:mm')}">Due date</span>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group-vertical" role="group">
                                <!-- Status Update Dropdown -->
                                <div class="dropdown mb-2">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle"
                                            type="button" data-bs-toggle="dropdown">
                                        <i class="bi bi-arrow-repeat me-1"></i>Update Status
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li th:each="status : ${taskStatuses}">
                                            <form th:action="@{/tasks/{id}/status(id=${task.id})}" method="post" class="d-inline">
                                                <input type="hidden" name="status" th:value="${status}">
                                                <button type="submit" class="dropdown-item"
                                                        th:class="${status == task.status} ? 'active' : ''"
                                                        th:text="${status.displayName}">Status</button>
                                            </form>
                                        </li>
                                    </ul>
                                </div>

                                <!-- Action Buttons -->
                                <div class="btn-group" role="group">
                                    <a th:href="@{/tasks/{id}/edit(id=${task.id})}"
                                       class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <form th:action="@{/tasks/{id}/delete(id=${task.id})}" method="post" class="d-inline">
                                        <button type="submit" class="btn btn-sm btn-outline-danger delete-task">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div class="text-center py-5" th:if="${tasks.empty}">
        <i class="bi bi-clipboard-x display-1 text-muted"></i>
        <h3 class="mt-3 text-muted">No tasks found</h3>
        <p class="text-muted">Get started by creating your first task.</p>
        <a href="/tasks/new" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Create Task
        </a>
    </div>
</main>

<th:block th:replace="~{layout :: footer}"></th:block>
<th:block th:replace="~{layout :: scripts}"></th:block>
</body>
</html>
